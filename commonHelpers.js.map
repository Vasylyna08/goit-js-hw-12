{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport axios from 'axios';\n\nconst BASE_URL = 'https://pixabay.com/api/';\nconst API_KEY = '41985459-07284690ed1bbc3dd300f203e';\n\nconst formEl = document.querySelector('.form');\nconst galleryEl = document.querySelector('.gallery');\nconst loaderEl = document.querySelector('.loader');\nconst loadButtonEl = document.querySelector('.load-button');\nconst liEl = document.querySelector('.gallery-item');\n\nconst hiddenClass = 'is-hidden';\n\nlet query = '';\nlet page = 1;\nlet maxPage = 0;\n\nconst refreshGallery = new SimpleLightbox('.gallery-item a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nformEl.addEventListener('submit', handleSearch);\n\nasync function handleSearch(event) {\n  event.preventDefault();\n  galleryEl.innerHTML = '';\n  page = 1;\n  loaderEl.classList.remove(hiddenClass);\n  const form = event.currentTarget;\n  query = form.elements.query.value;\n  if (!query) {\n    loadButtonEl.classList.add(hiddenClass);\n    onFetchError();\n    return;\n  }\n  try {\n    const data = await fetchImage(query);\n    maxPage = Math.ceil(data.totalHits / 40);\n    createMarkup(data);\n\n    if (data.hits.length > 0 && data.hits.length !== data.totalHits) {\n      loadButtonEl.classList.remove(hiddenClass);\n      loadButtonEl.addEventListener('click', handleLoadMore);\n    } else if (!data.hits.length) {\n      loadButtonEl.classList.add(hiddenClass);\n      onFetchError();\n    } else {\n      loadButtonEl.classList.add(hiddenClass);\n    }\n  } catch (error) {\n    onFetchError(error);\n  } finally {\n    loaderEl.classList.add(hiddenClass);\n    form.reset();\n  }\n}\n\nasync function fetchImage(imageName, page = 1) {\n  try {\n    const response = await axios.get(`${BASE_URL}`, {\n      params: {\n        key: API_KEY,\n        q: imageName,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        page: page,\n        per_page: 40,\n      },\n    });\n    return response.data;\n  } catch (error) {\n    onFetchError(error);\n  }\n}\n\nasync function handleLoadMore() {\n  page += 1;\n  scrollPage();\n  loadButtonEl.disabled = true;\n  loaderEl.classList.remove(hiddenClass);\n\n  try {\n    const data = await fetchImage(query, page);\n    createMarkup(data);\n  } catch (error) {\n    onFetchError(error);\n  } finally {\n    loadButtonEl.disabled = false;\n    loaderEl.classList.add(hiddenClass);\n\n    if (page === maxPage) {\n      loadButtonEl.classList.add(hiddenClass);\n      loadButtonEl.removeEventListener('click', handleLoadMore);\n      iziToast.show({\n        title: 'Error',\n        messageColor: '#fff',\n        messageSize: '20px',\n        backgroundColor: '#EF4040',\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'bottomCenter',\n      });\n    }\n  }\n}\n\nfunction createMarkup(data) {\n  const markup = data.hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `\n      <li class=\"gallery-item\">\n  <a class=\"gallery-link\" href=\"${largeImageURL}\">\n    <img\n      class=\"gallery-image\"\n      src=\"${webformatURL}\"\n      data-source=\"${largeImageURL}\"\n      alt=\"${tags}\"\n    />\n    <p class= \"gallery-text\">• Likes: ${likes} • Views: ${views} • Comments: ${comments} •</span> Downloads:${downloads}</p>\n  </a>\n</li>`\n    )\n    .join('');\n  galleryEl.insertAdjacentHTML('beforeend', markup);\n  refreshGallery.refresh();\n}\n\nfunction scrollPage() {\n  const twoHeight = liEl.getBoundingClientRect().height * 2;\n\n  window.scrollBy({\n    top: twoHeight,\n    behavior: 'smooth',\n  });\n}\n\nfunction onFetchError(error) {\n  iziToast.error({\n    title: 'Error',\n    message:\n      'Sorry, there are no images matching your search query. Please try again!',\n    position: 'topRight',\n    messageColor: '#fff',\n    messageSize: '20px',\n    backgroundColor: '#EF4040',\n    close: false,\n    closeOnClick: true,\n    progressBarEasing: 'linear',\n  });\n}\n"],"names":["BASE_URL","API_KEY","formEl","galleryEl","loaderEl","loadButtonEl","liEl","hiddenClass","query","page","maxPage","refreshGallery","SimpleLightbox","handleSearch","event","form","onFetchError","data","fetchImage","createMarkup","handleLoadMore","imageName","axios","scrollPage","iziToast","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","twoHeight","error"],"mappings":"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"}